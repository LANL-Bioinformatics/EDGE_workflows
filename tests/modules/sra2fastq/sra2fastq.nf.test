nextflow_workflow {

    name "Test Workflow SRA2FASTQ"
    script "modules/sra2fastq/sra2fastq.nf"
    workflow "SRA2FASTQ"

    test("SRR29462562") {

        when {
            params {
                shared {
                    outDir = "./testing_output"
                    projName = "PROJECT"
                    cpus = 4
                }
                sra2fastq {
                    accessions = ["SRR29462562"]
                }
            }
            workflow {
                """
                input[0] = params.sra2fastq.plus(params.shared)
                """
            }
        }

        then {
            assert workflow.success
        }

    }
    
    test("SRR29462562-Ensure Illumina platform") {

        when {
            params {
                shared {
                    outDir = "./testing_output"
                    projName = "PROJECT"
                    cpus = 4
                }
                sra2fastq {
                    platformRestrict = "Illumina"
                    accessions = ["SRR29462562"]
                }
            }
            workflow {
                """
                input[0] = params.sra2fastq.plus(params.shared)
                """
            }
        }

        then {
            assert workflow.success
        }

    }

    test("SRR29462562-Ensure not PACBIO_SMRT platform") {

        when {
            params {
                shared {
                    outDir = "./testing_output"
                    projName = "PROJECT"
                    cpus = 4
                }
                sra2fastq {
                    platformRestrict = "PACBIO_SMRT"
                    accessions = ["SRR29462562"]
                }
            }
            workflow {
                """
                input[0] = params.sra2fastq.plus(params.shared)
                """
            }
        }

        then {
            assert workflow.failed
        }

    }
        test("SRR29462562-Ensure not OXFORD_NANOPORE platform") {

        when {
            params {
                shared {
                    outDir = "./testing_output"
                    projName = "PROJECT"
                    cpus = 4
                }
                sra2fastq {
                    platformRestrict = "OXFORD_NANOPORE"
                    accessions = ["SRR29462562"]
                }
            }
            workflow {
                """
                input[0] = params.sra2fastq.plus(params.shared)
                """
            }
        }

        then {
            assert workflow.failed
        }

    }
}
